__d((function(g,r,i,a,m,e,d){"use strict";function n(){const t=r(d[0]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.ClientNormalizeSearchPaths=function({redirectUrl:l}){var s;const u=(0,p.useLocation)();return l=null!==(s=l)&&void 0!==s?s:S(u),(0,t.useEffect)(()=>{if(null!=l){const t=(0,n().parsePath)(l);(0,E.replaceToHistory)(t.pathname,{params:(0,c.default)(t.search)})}},[l]),null},e.getRedirectUrl=S;var t=r(d[1]),l=r(d[2]),s=r(d[3]),u=r(d[4]),o=r(d[5]),c=babelHelpers.interopRequireDefault(r(d[6])),E=r(d[7]),p=r(d[8]),f=babelHelpers.interopRequireDefault(r(d[9]));function h(n){return n.replace(/^\/s\/[^/]+\/(homes|experiences)/,'/s/:location/$1')}function S(n){var t;const E=(0,l.selectFiltersFromURL)({pathname:n.pathname,queryString:n.search}),p=(E||{}).refinement_paths,S=(0,s.getTabFromRefinementPaths)(p),R={tabId:S,basePath:o.SEARCH_ENDPOINT};let _=n.search;const O=(0,c.default)(_),P=(0,u.makeSearchPath)(E,R);if(![o.EXPLORE_TABS.HOMES,o.EXPLORE_TABS.EXPERIENCES].includes(S))return S===o.EXPLORE_TABS.ADVENTURES||S===o.EXPLORE_TABS.SELECT_HOMES?(_=decodeURIComponent((0,u.makeQueryStrings)(O,R)),`${P}${_}`):'/';if(null!==(t=null==p?void 0:p.some(n=>'string'==typeof n&&n.startsWith('/playlists')))&&void 0!==t&&t)return'/';const T=null==p?void 0:p[0];return(0,u.isOnlineExperiences)(E,null!=S?S:o.EXPLORE_TABS.HOMES)&&null!=O.refinement_paths&&'/experiences'!==T&&!(0,u.isOnlineExperiencesSearchRefinementPath)(E)?(_=decodeURIComponent((0,u.makeQueryStrings)((0,f.default)(O,['refinement_paths']),R)),`${P}${_}`):!(0,u.isOnlineExperiences)(E,null!=S?S:o.EXPLORE_TABS.HOMES)||null==E.location&&null==E.query&&null==E.place_id?h(n.pathname)!==h(P)?`${P}${_}`:null:(_=decodeURIComponent((0,u.makeQueryStrings)((0,f.default)(O,['location','query','place_id']),R)),`${P}${_}`)}}),"0ef88a",["d69748","a27fc3","3d44ce","1b01f9","f4229b","87916a","a7c4ef","4ee5a9","1e300f","3d4f9e"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return t.default.get('exploreTreatments')||[]};var t=babelHelpers.interopRequireDefault(r(d[0]))}),"23c701",["0a58da"]);
__d((function(g,r,i,a,m,e,d){"use strict";function t(n){return null==n?[]:Array.isArray(n)?n.flatMap(t):'string'==typeof n?[n]:[JSON.stringify(n)]}Object.defineProperty(e,"__esModule",{value:!0}),e.convertToRawParams=function(n){const s=[];return Object.keys(n).forEach(o=>{const u=t(n[o]);s.push({filterName:o,filterValues:u})}),s}}),"294886",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=o,e.replaceToHistory=function(t,s={}){o((0,n.getHistory)(),t,s)};var t=babelHelpers.interopRequireDefault(r(d[0])),n=r(d[1]);function o(n,o,{maintainScrollPosition:s=!1,maintainQueryParams:l=!1,maintainHash:u=!1,params:c,state:f}={}){const p=(0,t.default)(o,{maintainQueryParams:l,maintainHash:u,params:c});n.replace(p,f),g.window&&!s&&g.window.scrollTo(0,0)}}),"4ee5a9",["be6a20","7934b6"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(l=[]){const n=l.map(({treatmentFlag:t})=>t).filter(t.default).flat(1);return[...new Set(n)]};var t=babelHelpers.interopRequireDefault(r(d[0]))}),"6e1627",["f30bc0"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.manageTreatmentFlagsWithUpfrontPricingFlag=function(t){let n=t;const u=!!o.default.current().enable_upfront_pricing;u||(n=t.filter(t=>"upfront_pricing_enabled"!==t));u&&!t.includes("upfront_pricing_enabled")&&(n=[...t,"upfront_pricing_enabled"]);return n.filter(R.default)},e.maybeRemoveUpfrontPricingParamsFromUrl=function(){requestIdleCallback(()=>{const t=o.default.current().enable_upfront_pricing;void 0!==t&&(0,f.airdogCount)('search.upfront_pricing.access_with_cookie',1,"value: "+t)}),(0,l.default)().enable_upfront_pricing&&(0,p.getHistory)().replace((function(){const t=(0,l.default)(),{pathname:o,hash:u}=window.location,p={...t};delete p.enable_upfront_pricing;const c=(0,n.stringify)(p);return`${o}?${c}${u}`})())},e.setEnableUpfrontPricing=async function(t){return await(c.default.getBootstrap('api_web_client_migration.fejax.enabled')&&!c.default.getBootstrap('api_web_client_migration.fejax.pricing_guest.kill_switch')?(0,h().logMigration)(b().default.get("/_/core-guest-loop/upfront-pricing",{searchParams:{enable_upfront_pricing:t?'true':'false'}}),{method:'GET',client:'niobe',migrationId:'pricing_guest',group:'fejax'}):(0,h().logMigration)(u.default.ajax("/_/core-guest-loop/upfront-pricing?enable_upfront_pricing="+(t?'true':'false'),{dataType:'json',processResponse:!1}),{method:'GET',client:'fejax',migrationId:'pricing_guest',group:'fejax'})),o.default.setCurrent({...o.default.current(),enable_upfront_pricing:t}),Promise.resolve()},e.shouldShowToggleUIIteration=function(){return(0,I.runExperiment)({deliver:()=>'treatment'===s.default.findTreatment('pricing_upfront_pricing_2023_h2_ui_iteration_v1',{log:!1}),gatingTrebuchet:c.default.getBootstrap('pricing_upfront_pricing_2023_h2_ui_iteration_v1'),launchTrebuchet:c.default.getBootstrap('pricing_upfront_pricing_2023_h2_ui_iteration_v1_force_in'),treatmentOverrideName:'upfront-pricing-ui-iteration',onCondition:()=>!v()})},e.shouldShowUpfrontPricingBanner=function(){if(c.default.getBootstrap('pricing_upfront_pricing_2022_toggle_killswitch'))return!1;if(v())return!1;return!0};var t=babelHelpers.interopRequireDefault(r(d[0])),n=r(d[1]),o=babelHelpers.interopRequireDefault(r(d[2])),u=babelHelpers.interopRequireDefault(r(d[3])),l=babelHelpers.interopRequireDefault(r(d[4])),p=r(d[5]),c=babelHelpers.interopRequireDefault(r(d[6])),f=r(d[7]),_=r(d[8]),s=babelHelpers.interopRequireDefault(r(d[9]));function b(){const t=babelHelpers.interopRequireDefault(r(d[10]));return b=function(){return t},t}function h(){const t=r(d[11]);return h=function(){return t},t}var R=babelHelpers.interopRequireDefault(r(d[12])),I=r(d[13]);const T=['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','GB','IS','LI','NO','AU','KR','CH','HU','CA','IL','CN','NZ'];function v(){return!!(T.includes(t.default.country())||T.includes(t.default.tld_country())||(0,_.isInChinaFlow)())}}),"74d137",["862e50","e950a3","06a99e","c3984f","a7c4ef","7934b6","c235f8","3e4681","b7eb08","dcc72a","69a7c4","7c530a","f30bc0","4be837"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logMigration=function(u,c){return Promise.resolve(u).then(()=>n({...c,result:'success'})).catch(u=>{n({...c,result:'error',responseStatus:null==u?void 0:u.status,noError:!u}),s.default.getBootstrap('niobe.rest.error_logging.kill_switch')||!u||u.status&&200!==u.status||((0,t.airdogCount)('rest_migration.debug',1,{...c,responseStatus:u.status,responseStatusText:u.statusText,message:u.message||'',name:u.name||''}),(0,o().reportNiobeError)(u,{fingerprint:['niobe'],tags:{...c}}))}).catch(()=>{}),u};var t=r(d[0]),s=babelHelpers.interopRequireDefault(r(d[1]));function o(){const t=r(d[2]);return o=function(){return t},t}function n(s){(0,t.airdogCount)('rest_migration.request',1,s)}}),"7c530a",["3e4681","c235f8","8e002d"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.feedMapDecouplingHomepageWebPreSSR=function(n){return!(null==n||!n.includes("feed_map_decouple_homepage_treatment"))},e.feedMapDecouplingM11WebPreSSR=function(u,t){return!n(u)&&!(null==t||!t.includes("feed_map_decouple_m11_treatment"))},e.isP2_5=n;function n(n){return null!=n.omni_page_id&&null!=n.dynamic_product_ids}}),"88c0d4",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(u,n=(0,t.default)()){return n.find(({experiment:t})=>t===u)};var t=babelHelpers.interopRequireDefault(r(d[0]))}),"9439c5",["23c701"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STAYS_SEARCH_FILTER_KEYS=e.KNOWN_SEARCH_QUERY_PARAMS=void 0;const _=['cursor','autosuggestions_options','max_categories','metadata_only','satori_version','search_type','source','treatment_flags','raw_params'];e.STAYS_SEARCH_FILTER_KEYS=_;const t=[..._,'inst','niobe_test_destinations','zoom'];e.KNOWN_SEARCH_QUERY_PARAMS=t}),"977a9f",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={document:void 0,getDocument:()=>r(d[1])(d[0]).then(babelHelpers.interopRequireWildcard).then(t=>t.default),name:'StaysSearch',type:'query',operationId:'1a484d2950ec1643a2890c2af08a5fbef78e27f455f6a18eee4dca3e3c7347b4'};e.default=t}),"a06569",["68b1a1","c592d7"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({location:c,cookie:b,niobeMinimalistClient:S,exploreTreatments:x,getRenderingState:R,customPrepareNiobeData:T,getErf:v}){const{isAirlite:y=!1,isBotRequest:E,formFactor:D=l.DEFAULT_FORM_FACTOR}=T||{},F=(0,t.createTaskController)(),h=(0,_.default)({cookie:b,exploreTreatments:x,getRenderingState:R,location:c,niobeMinimalistClient:S,formFactor:D,isAirlite:y}),k=(0,o.default)(c.search),q=(0,u.getRedirectUrl)(c);let w=!1;E||(w=!0);f.forEach(t=>{(0,n.default)({experimentName:t,exploreTreatments:x,renderingState:R(),getErfServer:v})}),(0,s.isP2_5)(k)||(D===l.FORM_FACTOR.WIDE?(0,n.default)({experimentName:"feed_map_decoupling_m11_desktop",exploreTreatments:x,renderingState:R(),getErfServer:v}):(0,n.default)({experimentName:"feed_map_decoupling_m11_moweb",exploreTreatments:x,renderingState:R(),getErfServer:v}));(0,n.default)({experimentName:'bundled_category_bar_2022_with_category_bar_web_v2_aa',exploreTreatments:x,renderingState:R(),getErfServer:v});return(0,n.default)({experimentName:'bundled_category_bar_2022_with_category_bar_web_v2',exploreTreatments:x,renderingState:R(),getErfServer:v}),{queryRef:S.preloadQuery({context:{fetchOptions:{signal:null==F?void 0:F.signal},taskController:F},variables:h,query:p.default,deferrable:w,usePOSTForQuery:!0,skip:null!=q}),showDeferredSkeleton:w,redirectUrl:q}};var t=r(d[0]),l=r(d[1]),n=babelHelpers.interopRequireDefault(r(d[2])),o=babelHelpers.interopRequireDefault(r(d[3])),s=r(d[4]),u=r(d[5]),_=babelHelpers.interopRequireDefault(r(d[6])),p=babelHelpers.interopRequireDefault(r(d[7]));const f=['decompose_schema_cleanup_web']}),"a829bd",["a2c93f","b679e8","d271b5","a7c4ef","88c0d4","0ef88a","a8e410","a06569"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({exploreTreatments:_,location:f,formFactor:E,isAirlite:b}){const F=(0,l.default)(f.search),{mock:A}=F,R=E===u.FORM_FACTOR.COMPACT,S=(function(t){const l=new Set(['feed_map_decouple_homepage_desktop','feed_map_decouple_homepage_moweb']);return null==t?void 0:t.filter(({experiment:t})=>!l.has(t))})((function(t,l){if(l)return null==t?void 0:t.filter(({experiment:t})=>"new_filter_bar_search_feed_header_v2_desktop"!==t);return null==t?void 0:t.filter(({experiment:t})=>"new_filter_bar_v2_moweb"!==t)})(_,R));let T=[...s.STAYS_SEARCH_DECOMPOSE_COMPLETED_TREATMENT_FLAGS,...(0,n.default)(S)];const M=(0,t.feedMapDecouplingM11WebPreSSR)(F,T),C=T.includes(s.DecomposeFeatureFlags.M9),D=T.includes(s.DecomposeFeatureFlags.CLEANUP);D&&(T=T.filter(t=>!s.DEFAULT_WEB_TREATMENT_FLAGS.includes(t)));if(A)return{exploreRequest:{},mockIdentifier:"ExplorePresentation/"+A,feedMapDecoupleEnabled:M,decomposeFiltersEnabled:C,decomposeCleanupEnabled:D};const h=(0,o.selectFiltersForRequest)({location:f,cdnCacheSafe:!1,cdnExperiments:void 0,treatmentFlags:(0,p.manageTreatmentFlagsWithUpfrontPricingFlag)(T),isPWA:R,isAirlite:b}),P=(0,c.default)({location:f,requestedPageType:'STAYS_SEARCH',exploreRequest:h,isAirlite:b});return{staysSearchRequest:P,...M&&{staysMapSearchRequestV2:P},feedMapDecoupleEnabled:M,decomposeFiltersEnabled:C,decomposeCleanupEnabled:D}};var t=r(d[0]),l=babelHelpers.interopRequireDefault(r(d[1])),n=babelHelpers.interopRequireDefault(r(d[2])),o=r(d[3]),s=r(d[4]),u=r(d[5]),p=r(d[6]),c=babelHelpers.interopRequireDefault(r(d[7]))}),"a8e410",["88c0d4","a7c4ef","6e1627","3d44ce","f36c5b","b679e8","74d137","e16093"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({experimentName:l,exploreTreatments:u,renderingState:o,getErfServer:s}){const{treatmentName:f,log:p}=(0,n.default)(l,u)||{};f&&'manual'===p&&('server-render'===o?s(l):'client-render'===o&&t.default.logCustomHashing(l,f))};var t=babelHelpers.interopRequireDefault(r(d[0])),n=babelHelpers.interopRequireDefault(r(d[1]))}),"d271b5",["fc0842","9439c5"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.getRawParamSingleValue=function(l,t){var u,n;return null!==(u=null===(n=(function(l,t){if(null!=l){const u=l.find(l=>(null==l?void 0:l.filterName)===t);if(null!=(null==u?void 0:u.filterValues)&&u.filterValues.length>0)return u.filterValues}return null})(l,t))||void 0===n?void 0:n[0])&&void 0!==u?u:null},e.merge=function(l,u,n){const{rawParams:o,...s}=l,{rawParams:f,...c}=u,p=new Set(Object.keys(n||{}).map(t.default)),R={};null==o||o.forEach(({filterName:l,filterValues:t})=>{l&&!p.has(l)&&(R[l]=t)}),null==f||f.forEach(({filterName:l,filterValues:t})=>{l&&(R[l]=t)});const v=q(Object.entries(R).map(([l,t])=>({filterName:l,filterValues:t})));return{...s,...c,rawParams:v}},e.selectFiltersFromURL=v,e.selectSearchFiltersForRequest=b;var l=babelHelpers.interopRequireDefault(r(d[0])),t=babelHelpers.interopRequireWildcard(r(d[1])),u=babelHelpers.interopRequireWildcard(r(d[2])),n=babelHelpers.interopRequireDefault(r(d[3])),o=r(d[4]),s=babelHelpers.interopRequireDefault(r(d[5])),f=r(d[6]),c=r(d[7]);function p(n,o){return(0,t.snakeKeysToCamelKeys)((0,l.default)((0,u.coerceCorrectTypes)(n,{forRequest:!0}),o))}function R(t){return(0,l.default)((0,s.default)(t),c.KNOWN_SEARCH_QUERY_PARAMS)}function v({queryString:l}){const t={...R(l)};return{...(0,u.default)({...t})}}function q(l){const t=[...l];return t.sort((l,t)=>{var u,n;return(null!==(u=null==l?void 0:l.filterName)&&void 0!==u?u:'').localeCompare(null!==(n=null==t?void 0:t.filterName)&&void 0!==n?n:'')}),t}function b({location:u,exploreRequest:s,filterKeys:c,isAirlite:R=!1}){const b=(0,n.default)(s,...c.map(t.default)),y=v({queryString:null==u?void 0:u.search}),S=(0,l.default)((0,o.camelKeysToSnakeKeys)(s),c);return{...p({...y.cursor&&{cursor:y.cursor},...R&&{max_categories:8},...S,raw_params:q((0,f.convertToRawParams)(b))},c)}}var y=function({location:l,exploreRequest:t,requestedPageType:u,isAirlite:n=!1}){return{requestedPageType:u,...b({location:l,exploreRequest:t,filterKeys:c.STAYS_SEARCH_FILTER_KEYS,isAirlite:n})}};e.default=y}),"e16093",["45db44","fd0757","c6fd31","3d4f9e","2755ca","a7c4ef","294886","977a9f"]);
__d((function(g,r,i,a,m,e,d){"use strict";let _;Object.defineProperty(e,"__esModule",{value:!0}),e.STAYS_SEARCH_DECOMPOSE_COMPLETED_TREATMENT_FLAGS=e.HOMEPAGE_DECOMPOSE_COMPLETED_TREATMENT_FLAGS=e.EXPERIENCES_SEARCH_DECOMPOSE_COMPLETED_TREATMENT_FLAGS=e.DecomposeFeatureFlags=e.DEFAULT_WEB_TREATMENT_FLAGS=void 0,e.DecomposeFeatureFlags=_,(function(_){_.M2="decompose_stays_search_m2_treatment",_.M3="decompose_stays_search_m3_treatment",_.M3_5="decompose_stays_search_m3_5_treatment",_.M4="decompose_stays_search_m4_treatment",_.M5="decompose_experiences_search_m5_treatment",_.M9="decompose_filters_treatment",_.CLEANUP="decompose_schema_cleanup"})(_||(e.DecomposeFeatureFlags=_={}));const t=[_.M4];e.HOMEPAGE_DECOMPOSE_COMPLETED_TREATMENT_FLAGS=t;const E=[_.M2,_.M3,_.M3_5];e.STAYS_SEARCH_DECOMPOSE_COMPLETED_TREATMENT_FLAGS=E;const s=[_.M5];e.EXPERIENCES_SEARCH_DECOMPOSE_COMPLETED_TREATMENT_FLAGS=s;_.M3;const o=[_.M2,_.M3,_.M3_5,_.M4,_.M5,_.M9,_.CLEANUP,'super_date_flexibility','micro_flex_improvements','flexible_dates_12_month_lead_time','im_flexible_may_2022_treatment','pets_fee_treatment','flex_destinations_june_2021_launch_web_treatment','lazy_load_flex_search_map_compact','lazy_load_flex_search_map_wide','search_add_category_bar_ui_ranking_web','flexible_dates_options_extend_one_three_seven_days','micro_flex_show_by_default','search_input_placeholder_phrases'];e.DEFAULT_WEB_TREATMENT_FLAGS=o}),"f36c5b",[]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/stays-search/routes/StaysSearchRoute/StaysSearchRoute.prepare.b6d8fc27d1.js.map